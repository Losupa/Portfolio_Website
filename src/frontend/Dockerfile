# NOTE: everything should be "/usr/src/..." or "/usr/share/..."
# instead of "./src/..." or "./src/"

# Pulls and starts from official node image
FROM node:latest as build
# Creates ./src/app directory and makes it working
# directory so all RUN commands are launched from it by default
RUN mkdir -p ./src/app
WORKDIR ./src/app
# Copies package.json from the host to the container inside
# the app folder
COPY package.json ./src/app

# Installs dependencies listed in package.json
RUN npm install

# Copies react code to the container and builds the react app
# Starts teh server at port 3000 (when container is running)
RUN npm run build

# Pulls an official image of NGINX
FROM nginx:alpine
# Copies the build folder generated by React
# to to share/nginx/html folder
COPY --from=build ./src/app/build ./share/nginx/html
# Copies nginx.conf from the host to etc/nginx/nginx.conf
COPY nginx.conf /etc/nginx/nginx.conf

# Runs NGINX on port 80
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]